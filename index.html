<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Black Jack</title>
    <link rel="stylesheet" type="text/css" href="main.css" />
  </head>
  <body>
    <div id="wrapper">
      <div>
        <h1>BlackJack Game</h1>
        <h4>&#9733; Zdobądź 21 oczek, bądź więcej nie krupier! &#9733;</h4>
        <div class="money">Stan konta: <span id="pln">100</span> PLN</div>
        <div>
          Wielkość zakładu w złotówkach:
          <input type="number" id="mybet" value="5" min="1" max="200" />
          <button id="maxBet" type="button" onclick="maxbet()" class="btn">
            Max Bet
          </button>
        </div>
      </div>

      <div>
        <div id="message">Wciśnij start, aby rozpocząć</div>
        <div id="start">
          <button class="btn" id="btnStart" type="button" onclick="Start()">
            Start
          </button>
        </div>
      </div>
      <div id="context">
        Karty krupiera: <span id="dValue"></span>
        <div id="dealerHolder"></div>
        Karty gracza: <span id="pValue"></span>
        <div id="playerHolder"></div>
        <div id="myActions">
          <button
            id="btnHold"
            tpye="button"
            onclick="cardAction('hold')"
            class="btn"
          >
            Stój
          </button>
          <button
            id="btnHit"
            tpye="button"
            onclick="cardAction('hit')"
            class="btn"
          >
            Dobierz
          </button>
          <button
            id="btnDouble"
            tpye="button"
            onclick="cardAction('double')"
            class="btn"
          >
            Podwój
          </button>
        </div>
        <div class="NewGame__Wrapper">
          <button id="btnDeal" type="button" onclick="dealNew()" class="btn">
            Nowa gra
          </button>
        </div>
      </div>
    </div>

    <script>
      let wrapper = document.querySelector("#wrapper");
      let output = document.querySelector("#context");

      let cards = [];
      let playerCard = [];
      let dealerCard = [];
      let cardCount = 0;
      let myDollars = 100;
      let endPlay = false;
      let dealerHolder = document.querySelector("#dealerHolder");
      let playerHolder = document.querySelector("#playerHolder");
      let pValue = document.querySelector("#pValue");
      let dValue = document.querySelector("#dValue");
      let randomNumber = Math.floor(Math.random() * 52);
      let suits = ["spades", "clubs", "hearts", "diams"];
      let message = document.getElementById("message");
      let dollarValue = document.getElementById("pln");
      let numb = [
        "A",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "10",
        "J",
        "Q",
        "K"
      ];

      suits.forEach(s => {
        let suit = s[0].toUpperCase();
        let bgcolor = suit == "S" || suit == "C" ? "black" : "red";
        numb.forEach(n => {
          let cardValue =
            n === "A" ? 1 : n == "J" || n == "Q" || n == "K" ? 10 : parseInt(n);

          let card = {
            suit: suit,
            icon: s,
            bgcolor: bgcolor,
            cardnum: n,
            cardvalue: cardValue
          };
          cards.push(card);
        });
      });

      function Start() {
        shuffleDeck(cards);
        dealNew();
        document.getElementById("start").style.display = "none";
        dollarValue.innerHTML = myDollars;
      }

      function dealNew() {
        cards = cards;
        playerCard = [];
        dealerCard = [];
        dealerHolder.innerHTML = "";
        playerHolder.innerHTML = "";

        let betValue = document.getElementById("mybet").value;
        myDollars = myDollars - betValue;
        dollarValue.innerHTML = myDollars;

        document.getElementById("myActions").style.display = "block";
        message.innerHTML =
          "Get up to 21 and bet the dealer<br>Current bet is $" + betValue;
        document.getElementById("mybet").disabled = true;
        document.getElementById("maxBet").disabled = true;
        deal();
        document.querySelector("#btnDeal").style.display = "none";
      }

      function reDeal() {
        cardCount++;
        if (cardCount > 45) {
          shuffleDeck(cards);
          cardCount = 0;
          message.innerHTML = "Nowa talia kart!";
        }
      }

      function deal() {
        for (x = 0; x < 2; x++) {
          dealerCard.push(cards[cardCount]);
          dealerHolder.innerHTML += cardOutput(cardCount, x);

          x === 0
            ? (dealerHolder.innerHTML +=
                '<div id="cover" style="left:43%"></div>')
            : null;

          reDeal();
          playerCard.push(cards[cardCount]);
          playerHolder.innerHTML += cardOutput(cardCount, x);
          reDeal();
        }
        pValue.innerHTML = checkTotal(playerCard);
        dValue.innerHTML = "";
      }

      function cardOutput(num, x) {
        let hpos = x > 0 ? x * 5 + 42 : 43;

        return (
          '<div class="icard ' +
          cards[cardCount].icon +
          '" style="left:' +
          hpos +
          '%;"><div class="top-card suit">' +
          cards[cardCount].cardnum +
          '<br></div><div class="content-card suit"></div><div class="bottom-card suit">' +
          cards[cardCount].cardnum +
          "<br></div></div>"
        );
      }

      function cardAction(a) {
        switch (a) {
          case "hit":
            playuCard();
            break;
          case "hold":
            playEnd();

            break;
          case "double":
            playuCard();
            playEnd();

            break;
          default:
            break;
        }
      }

      function playuCard() {
        playerCard.push(cards[cardCount]);
        playerHolder.innerHTML += cardOutput(cardCount, playerCard.length - 1);
        reDeal();
        let rValu = checkTotal(playerCard);
        pValue.innerHTML = rValu;

        if (rValu > 21) {
          message.innerHTML = "Za dużo!";
          playEnd();
        }
      }

      function playEnd() {
        endPlay = true;
        document.querySelector("#cover").style.display = "none";
        document.querySelector("#myActions").style.display = "none";
        document.querySelector("#btnDeal").style.display = "block";
        document.querySelector("#mybet").style.display = false;
        document.querySelector("#maxBet").style.display = false;
        message.innerHTML = "Przegrałeś!";
        let payoutJack = 1;

        let dealerValue = checkTotal(dealerCard);
        dValue.innerHTML = dealerValue;

        while (dealerValue < 17) {
          dealerCard.push(cards[cardCount]);
          dealerHolder.innerHTML += cardOutput(
            cardCount,
            dealerCard.length - 1
          );
          reDeal();
          dealerValue = checkTotal(dealerCard);
          dValue.innerHTML = dealerValue;
        }

        let playerValue = checkTotal(playerCard);
        if (playerValue === 21 && playerCard.length === 2) {
          message.innerHTML = "Black Jack !!";
          payoutJack = 1.5;
        }

        let betValue =
          parseInt(document.getElementById("mybet").value) * payoutJack;

        if (
          (playerValue < 22 && playerValue > dealerValue) ||
          (dealerValue > 21 && playerValue < 22)
        ) {
          message.innerHTML +=
            '<span style="color:green;">Wygrałeś! ' + betValue + " pln</span>";
          myDollars = myDollars + betValue * 2;
        } else if (playerValue > 21) {
          message.innerHTML +=
            '<span style="color:red;">Przegrałeś! ' + betValue + " pln</span>";
          myDollars = myDollars - betValue;
        } else if (playerValue === dealerValue) {
          message.innerHTML +=
            '<span style="color:blue;">Remis! ' + betValue + " pln</span>";
          myDollars = myDollars + betValue;
        } else {
          message.innerHTML +=
            '<span style="color:red;">Przegrałeś! ' + betValue + " pln</span>";
        }

        pValue.innerHTML = playerValue;
        dollarValue.innerHTML = myDollars;
        document.getElementById("mybet").disabled = false;
        document.getElementById("maxBet").disabled = false;
      }

      function checkTotal(arr) {
        let rValue = 0;
        let aceAdjust = false;
        for (let i in arr) {
          if (arr[i].cardnum == "A" && !aceAdjust) {
            aceAdjust = true;
            rValue = rValue + 10;
          }
          rValue = rValue + arr[i].cardvalue;
        }
        if (aceAdjust && rValue > 21) {
          rValue = rValue - 10;
        }
        return rValue;
      }

      function shuffleDeck(array) {
        for (let i = array.length - 1; i > 0; i--) {
          let j = Math.floor(Math.random() * (i + 1));
          let temp = array[i];
          array[i] = array[j];
          array[j] = temp;
        }
        return array;
      }
    </script>
  </body>
</html>
